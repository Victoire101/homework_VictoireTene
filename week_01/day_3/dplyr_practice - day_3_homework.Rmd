---
title: '`dplyr` practice lab'
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    css: ../../../styles.css
  pdf_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = 'center')
```

You now have an opportunity to practice the skills you've learnt today in a mini lab task. For this you will be using data which contains income generated by US states from year 2002 to 2015. The data is available from CodeClanData in the dataset `state_income_data`.

```{r, message=FALSE, warning=FALSE}
library(CodeClanData)
```

```{r}
```state_income_data

# MVP
<br>
**Question 1.** 

Load in the data, and have a look at it. How many variables does it have? How many observations? What are the variable names? What type of variables does it have?
```


```{r}
library(tidyverse)

```


```{r}
dim(state_income_data)
names(state_income_data)
glimpse(state_income_data)

```
- This data set contains `16 variables` and `51 observations`.
- The variables names are: "Index", "State", "Y2002", "Y2003", "Y2004", "Y2005", "Y2006", "Y2007", "Y2008", "Y2009", "Y2010". "Y2011", "Y2012", "Y2013", "Y2014" and "Y2015".
- This data set contains variable of type `character` and `double`


<br>
**Question 2.** 

Select the columns which contain the information from years `2002` to `2008`. Ensure you keep the `Index` and `State` variables as well. 

```{r}
data_2002_to_2008 <- select(state_income_data, -Y2009, - Y2010, -Y2011, -Y2012, -Y2013, -Y2014, -Y2015)
 # or data_2002_to_2008 <- select(state_income_data, -(Y2009:Y2015))
 # or data_2002_to_2008 <- select(state_income_data, index:Y2008) # inclusive
 # or data_2002_to_2008 <- select(state_income_data, index:Y2003, Y2005:Y2008)
```



<br>
**Question 3.** 

Rename the `Index` column to `first_letter`. *Hint: look up the `rename()` function*. 

```{r}
rename(data_2002_to_2008, first_letter = Index)
```

<br>
**Question 4.** 

Find the seven states which start with an `A`,`B`, or `C`. 

```{r}
seven_states <- filter(data_2002_to_2008, substr(State,1,1) == "A" |substr(State,1,1) == "B" |substr(State,1,1) == "C")

# filter(data_2002_to_2008,
                     #  substr(State,1,1) == "A" |
                        # substr(State,1,1) == "B" |
                        # substr(State,1,1) == "C")  this is a better format for readability

```


%in%  :  test for membership
is LHS in the RHS
_CAUTION_ if the LHS is longer than 1 element, it might not work the way you think
4 %in% 1:3 ?

```{r}
filter(state_renamed, first_letter %in% c("A","B","C"))

```

```{r}
filter(data_2002_to_2008, 
                       index == 'A' |
                         index == 'B' |
                         index == 'C')
```


<br>
**Question 5.** 

Find which of these seven states have the greatest income in 2008. 

```{r}
seven_states %>% 
arrange(desc(Y2008))
## max(seven_states$Y2008, na.rm = TRUE)
```

<br>
**Question 6.** 

Calculate the change in income for each state of these seven states (states starting with `A`,`B`, or `C`) between 2002 and 2008. Save the income change in a new column called `income_change`.   

```{r}
seven_states %>% 
mutate (income_change = Y2008 - Y2002,
          .before = Y2002) #%>% 
 # filter(book_multiple < 20)
```

<br>
**Question 7.** 

Find which of these seven states income change is greater than 500,000 (i.e. an increase of 500,000 or decrease of 500,000).  
 
```{r}
seven_satate_new <- seven_states %>% 
mutate (income_change = Y2008 - Y2002,
          .before = Y2002) %>% 
 filter(income_change > abs(500000))
```

 
<br>
**Question 8.** 

Calculate the mean and median income change for all seven states.

```{r}
mean(seven_satate_new$income_change, na.rm = TRUE)
median(seven_satate_new$income_change, na.rm = TRUE)

```

<br>
**Question 9.** 

Go back to the original dataset which contains all states. Write a pipe which selects the `State` and `Y2008` variables, arranges the income from highest to lowest, filters all those states which have a income of greater than 1 million, and then finally chooses the top 10 wealthiest states.  
<br>

```{r}
state_income_data %>% 
  select(State, Y2008) %>% 
  arrange(desc(Y2008)) %>% 
  filter (Y2008 > 1000000) %>% 
  head (10)

```

